jQuery(document).ready((function(){const e=mwb_gf_ajax_data.crm,t=mwb_gf_ajax_data.ajaxUrl,n=mwb_gf_ajax_data.ajaxNonce,i=mwb_gf_ajax_data.ajaxAction,o=mwb_gf_ajax_data.criticalError,a=mwb_gf_ajax_data.feedBackLink,r=mwb_gf_ajax_data.feedBackText,s=mwb_gf_ajax_data.isPage,l=mwb_gf_ajax_data.trashIcon,d=mwb_gf_ajax_data.apiKeyImg,c=mwb_gf_ajax_data.webtoImg,u=mwb_gf_ajax_data.adminUrl;let f,_;const m=(e,t,n)=>{let i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+n+"$2"):e+o+t+"="+n};async function h(e){try{return await jQuery.ajax({url:t,type:"POST",data:e,beforeSend:function(){}})}catch(e){console.error(e)}}const y=(e="Something went wrong")=>{Swal.fire({icon:"error",title:"Opps...!!",text:e})},p=(e="")=>{Swal.fire({icon:"info",title:"Alert",text:e})},j=(e,t,n)=>{let i=e.find("option");jQuery.each(i,(function(){t==jQuery(this).attr("value")&&jQuery(this).attr("disabled",n)})),e.prop("selectedIndex",0)},w=(e,t,n)=>{if(0!=e.length)if("add"==n){let n='<option value="'+e+'">'+t+"</option>";jQuery("#primary-field-select").append(n)}else"remove"==n&&jQuery.each(jQuery("#primary-field-select").find("option"),(function(){e==jQuery(this).attr("value")&&jQuery(this).remove()}))},b=t=>{h(t).then((t=>{1==t.status&&t.data.hasOwnProperty("html")&&(jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").slideUp(),jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").remove(),jQuery(".mwb-feed__select-object").closest("div.mwb_"+e+"_gf__feeds-wrap").parent().append(t.data.html),jQuery(".mwb-content-wrap").slideDown())}))},Q=e=>{h(e).then((e=>{1==e.status&&(_=e.data.form,f=e.data.filter)}))},g=()=>{jQuery("#mwb-feeds-"+e+"-object").prop("selectedIndex",0),jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").slideUp(),jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").remove(),jQuery("#mwb_"+e+"_gf_feeds_condition_meta_box").slideUp()},v=(e=1)=>{let t="";return t+='<div class="or-condition-filter" data-or-index="'+e+'">',t+='<div class="mwb-form-filter-row">',t+='<div class="and-condition-filter" data-or-index="'+e+'" data-and-index="1">',t+='<select name="condition['+e+'][1][field]" class="condition-form-field">',t+='<option value="-1">Select Field</option>',jQuery.each(_,(function(e,n){t+='<optgroup label="'+e+'">',jQuery.each(n,(function(e,n){t+='<option value="'+e+'" >'+n+"</option>"})),t+="</optgroup>"})),t+="</select>",t+='<select name="condition['+e+'][1][option]" class="condition-option-field">',t+='<option value="-1">Select Condition</option>',jQuery.each(f,(function(e,n){t+="<option value="+e+">"+n+"</option>"})),t+="</select>",t+='<input type="text" name="condition['+e+'][1][value]" class="condition-value-field" value="" placeholder="Enter value">',t+="</div>",1!=e&&(t+='<img src="'+l+'" class="dashicons-trash" alt="Trash" id="condition_trash_new">'),t+='<button data-next-and-index="2" data-or-index="'+e+'" class="button condition-and-btn">Add "AND" filter</button>',t+="</div></div>",t};var x,k;(()=>{let t=jQuery("#mwb-"+e+"-gf-select-form").val(),o=jQuery("#mwb-feeds-"+e+"-object").val(),a=jQuery("#post_ID").val(),r=jQuery("#post_type").val(),s=jQuery("#original_post_status").val();if("-1"!=o&&"-1"!=t&&""!=a&&"mwb_"+e+"_gf"==r)if("publish"==s){let e={action:i,nonce:n,event:"create_feed_filters",selected_form:t};b({action:i,nonce:n,event:"get_object_fields_for_mapping",post_id:a,selected_object:o,selected_form:t}),Q(e)}else jQuery("#mwb-feeds-"+e+"-object").trigger("change")})(),jQuery(".mwb_"+e+"_gf_tips").tipTip({attribute:"data-tip",delay:200,defaultPosition:"bottom"}),x=a,k=r,jQuery("body").hasClass("post-type-mwb_"+e+"_gf")&&jQuery(".page-title-action").after('<a class="page-title-action" href="'+x+'">'+k+"</a>"),(()=>{if(jQuery("body").hasClass("post-type-mwb_"+e+"_gf")){let e=jQuery('input[name="post_title"]').val(),t=jQuery('input[name="post_ID"]').val();e||jQuery('input[name="post_title"]').val("Feed #"+t)}})(),jQuery("body").hasClass("post-type-mwb_"+e+"_gf")&&(jQuery("div#visibility.misc-pub-section.misc-pub-visibility").css("display","none"),jQuery("div#delete-action").css("display","none")),"-1"==jQuery("#mwb-"+e+"-gf-select-form").val()?jQuery("#mwb_"+e+"_gf_feeds_condition_meta_box").slideUp():jQuery("#mwb_"+e+"_gf_feeds_condition_meta_box").slideDown(),"logs"==s&&(()=>{let t=jQuery("#mwb-"+e+"-gf-logs").attr("ajax_url");t+="?action=get_datatable_logs",jQuery("#mwb-"+e+"-gf-table").DataTable({processing:!0,serverSide:!0,ajax:t,scrollX:!0,dom:'tr<"bottom"ilp>',ordering:!1,pagination:!1,responsive:{details:{type:"column"}},columnDefs:[{className:"dtr-control",orderable:!1,targets:0}],order:[1,"asc"],language:{lengthMenu:"Rows per page _MENU_",info:""}})})(),jQuery(".condition-option-field  option:selected").each((function(){let e=jQuery(this).val();jQuery(this).next(".condition-value-field"),"empty"!=e&&"not_empty"!=e||jQuery(this).closest(".and-condition-filter").find(".condition-value-field").val("").attr("disabled","disabled").removeAttr("placeholder")})),jQuery("body").hasClass("forms_page_mwb_"+e+"_gf_page"),jQuery('input[name="mwb_setting[enable_notif]"]').on("change",(function(){jQuery(this).is(":checked")?jQuery("#mwb_"+e+"_gf_email_notif").removeClass("is_hidden"):jQuery("#mwb_"+e+"_gf_email_notif").addClass("is_hidden")})),jQuery("#mwb-mautic_gf-auth_type").on("change",(function(){let e=jQuery(this).val();"basic"==e?(jQuery("#row-hide-clientid").hide(),jQuery("#row-hide-secretid").hide(),jQuery("#row-hide-username").show(),jQuery("#row-hide-password").show()):"oauth2"==e?(jQuery("#row-hide-clientid").show(),jQuery("#row-hide-secretid").show(),jQuery("#row-hide-username").hide(),jQuery("#row-hide-password").hide()):(jQuery("#row-hide-clientid").hide(),jQuery("#row-hide-secretid").hide(),jQuery("#row-hide-username").hide(),jQuery("#row-hide-password").hide())})),jQuery(document).on("click",".edit-post-status",(function(){jQuery("#post_status").html('<option selected="selected" value="publish">Published</option><option value="draft">Draft</option>')})),jQuery(window).on("load",(function(){jQuery(".is_hidden_accounts_tab").attr("style","display:none")})),jQuery('input[name="mwb_setting[delete_logs]"]').on("keyup change focusout",(function(){if(jQuery(this).val()<0&&jQuery(this).val(0),jQuery(this).val()%1!=0){let e=jQuery(this).val();e=e.toString(),e.length>4&&y("Value must be Integer")}})),jQuery("#mwb-showauth-form").on("click",(function(e){e.preventDefault(),jQuery(".mwb-intro").slideUp("400",(function(){jQuery(".mwb_sf_gf__account-wrap").slideDown()}))})),jQuery(document).on("click",".trigger-setup-guide",(function(){(e=>{switch(e){case"oauth2":Swal.fire({title:"How to get the API keys?",html:'<ul class="mwb_list_points" id="instructions_points_alignment"><li>Go to Mautic Configuration / API Settings and set "API enabled" to "Yes".</li><li>Then click on setting icon and go to Api Credentials</li><li>Then Select OAuth2, and click on "New" on top right corner.</li><li>Enter any name in app name section and enter.</li><li>Enter '+u+' callback URL</li><li>click on Apply on top right corner.</li><li>Save app, Copy Client Id & Client Secret Key.</li></ul><img class="instruction_image" src="'+d+'">',allowOutsideClick:!1});break;case"basic":Swal.fire({title:"No need of Api keys in basic auth.",html:'<ul class="mwb_list_points"><li>In basic authentication, you just need username and password of mautic from which you logged in to mautic.</li></ul><img class="instruction_image" src="'+c+'">',allowOutsideClick:!1})}})(jQuery("#mwb-mautic_gf-auth_type").val())})),jQuery(".mwb-section__sub-heading__wrap").on("click",(function(){jQuery(this).toggleClass("mwb-slide"),jQuery(this).siblings(".mwb-sf_gf__status-wrap").slideToggle(300)})),jQuery(".mwb-toggle-view").on("click",(function(e){e.preventDefault();let t=jQuery(this).parent().siblings("input");jQuery(this).hasClass("dashicons-visibility")?(t.attr("type","text"),jQuery(this).removeClass("dashicons-visibility").addClass("dashicons-hidden")):(t.attr("type","password"),jQuery(this).removeClass("dashicons-hidden").addClass("dashicons-visibility"))})),jQuery("#mwb-"+e+"_gf-authorize-button").on("click",(function(t){if(t.preventDefault(),href=jQuery(this).attr("href"),consumer_key=jQuery("#mwb-"+e+"_gf-consumer-key").val(),consumer_secret=jQuery("#mwb-"+e+"_gf-consumer-secret").val(),auth_type=jQuery("#mwb-"+e+"_gf-auth_type").val(),redirect_url=jQuery("#mwb-"+e+"_gf-redirect-url").val(),username=jQuery("#mwb-"+e+"_gf-username").val(),password=jQuery("#mwb-"+e+"_gf-password").val(),"oauth2"==auth_type)0==consumer_key.length||0==consumer_secret.length?y("All fields are required."):redirect_url?(href=m(href,"consumer_key",consumer_key),href=m(href,"consumer_secret",consumer_secret),href=m(href,"auth_type",auth_type),href=m(href,"redirect_uri",redirect_url),jQuery(this).attr("href",href),window.location.href=href):y("All fields are required.");else if("basic"==auth_type)if(0==username.length||0==password.length)y("All fields are required.");else if(redirect_url){h({action:i,nonce:n,event:"check_basic_auth_credentials",username:username,password:password}).then((e=>{"Success"!==e?(y(e),href=m(href,"auth_type",auth_type),href=m(href,"redirect_uri",redirect_url),href=m(href,"username",username),href=m(href,"password",password),jQuery(this).attr("href",href),setTimeout((function(){window.location.href=href}),3e3)):(href=m(href,"auth_type",auth_type),href=m(href,"redirect_uri",redirect_url),href=m(href,"username",username),href=m(href,"password",password),jQuery(this).attr("href",href),window.location.href=href)}))}else y("All fields are required.");else y("All fields are required.")})),jQuery(".mwb-onboarding-complete").on("click",(function(e){e.preventDefault();h({action:i,nonce:n,event:"mark_onboarding_complete"}).then((e=>{1==e.status?1==e.data.success&&location.reload():y()}))})),jQuery("#mwb_"+e+"_gf_refresh_token").on("click",(function(t){jQuery(this).css("pointer-events","none"),h({action:i,nonce:n,event:"refresh_"+e+"_access_token"}).then((t=>{1==t.status?1==t.data.success&&(((e="")=>{Swal.fire({icon:"success",title:"Process Complete",text:e,timer:1500})})("Access token renewed successfully."),jQuery("#mwb-"+e+"_gf-token-notice").text(t.data.connection_message),jQuery("#mwb-"+e+"_gf-token-notice").append("<br>"),jQuery("#mwb-"+e+"_gf-token-notice").append(t.data.token_message)):y(t.data.msg)}))})),jQuery("#mwb_"+e+"_gf_reauthorize").on("click",(function(e){e.preventDefault(),redirect=jQuery(this).attr("href"),0==redirect.length?y("Something went wrong!! Try reloading the page"):window.location.href=redirect})),jQuery("#mwb_"+e+"_gf_revoke").on("click",(function(t){t.preventDefault(),h({action:i,nonce:n,event:"revoke_"+e+"_gf_access"}).then((e=>{1==e.status?location.reload():y(e.message)}))})),jQuery('input[name="post_title"]').on("keyup",(function(){if(jQuery('input[name="post_title"]').val())jQuery("div#titlediv").children("div.inside").html("");else{let e='<span class="title_warning">*Title field can\'t be empty</span>';jQuery("div#titlediv").children("div.inside").html(e)}})),jQuery("#mwb-"+e+"-gf-select-form").on("change",(function(){let t=jQuery(this).val();if(g(),"-1"==t)return void g();jQuery("#mwb_"+e+"_gf_feeds_condition_meta_box").slideDown();let o=jQuery(this).val();h({action:i,nonce:n,event:"create_feed_filters",selected_form:o}).then((t=>{if(1==t.status){jQuery(".mwb-initial-filter").find(".or-condition-filter").remove(),_=t.data.form,f=t.data.filter;let n=v();jQuery(".condition-or-btn").before(n),jQuery(".condition-or-btn").attr("data-next-or-index",2),jQuery("#mwb_"+e+"_gf_feeds_condition_meta_box").slideDown(),jQuery("#mwb-"+e+"gf-feed-add-note").slideUp();let i=(()=>{if(0==jQuery("#mwb_"+e+"_gf_feeds_note_meta_box").length)return;let t="";return t+='<textarea name="add_feed_note" id="add-feed-note" cols="50" rows="2"></textarea>',t+='<div class="mwb_info">Choose form fields<code>{ field_id } </code>form the following form fields to add as note.</div>',t+='<select name="add-note-select" id="add-note-select">',t+='<option value="-1">Select field</option>',jQuery.each(_,(function(e,n){t+='<optgroup label="'+e+'">',jQuery.each(n,(function(e,n){t+='<option value="'+e+'" >'+n+"</option>"})),t+="</optgroup>"})),t+="</select>",t})();jQuery("#mwb-"+e+"gf-feed-add-note").html(i),jQuery("#mwb-"+e+"gf-feed-add-note").slideDown()}else y()}))})),jQuery("#mwb-feeds-"+e+"-object").on("change",(function(){if("-1"==jQuery("#mwb-"+e+"-gf-select-form").val())return jQuery(this).prop("selectedIndex",0),void p("Please select a form first");let t=jQuery(this).val(),o=jQuery("#mwb-"+e+"-gf-select-form").val();if("-1"==t)return;h({action:i,nonce:n,event:"get_object_fields_for_mapping",selected_object:jQuery.trim(t),selected_form:o}).then((t=>{1==t.status&&t.data.hasOwnProperty("html")&&(jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").slideUp(),jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").remove(),jQuery(".mwb-feed__select-object").closest("div.mwb_"+e+"_gf__feeds-wrap").parent().append(t.data.html),jQuery(".mwb-content-wrap").slideDown())}))})),jQuery("#mwb-"+e+"-refresh-object").on("click",(function(){let t="mwb-feeds-"+e+"-object",o={action:i,nonce:n,force:!0,event:"get_crm_objects"};jQuery(this).text("Loading..."),jQuery(this).css("pointer-events","none"),h(o).then((e=>{jQuery(this).text("Refresh Objects"),jQuery(this).css("pointer-events","auto"),1==e.status?e.hasOwnProperty("data")&&(1==e.data.success?((e,t)=>{let n='<option value="-1">Select an Object</option>';jQuery.each(t,(function(e,t){n+='<option value="'+e+'">'+t+"</option>"})),jQuery("#"+e).html(n)})(t,e.data.data):y(e.data.data)):y()}))})),jQuery("#mwb-"+e+"-refresh-fields").on("click",(function(){let t=jQuery("#mwb-feeds-"+e+"-object").val(),o=jQuery("#mwb-"+e+"-gf-select-form").val();if("-1"==t)return void y("Please select a Mautic Object first");let a={action:i,nonce:n,event:"get_object_fields_for_mapping",force:!0,selected_object:t,selected_form:o};jQuery(this).text("Loading..."),jQuery(this).css("pointer-events","none"),h(a).then((t=>{jQuery(this).text("Refresh Fields"),jQuery(this).css("pointer-events","auto"),1==t.status&&t.data.hasOwnProperty("html")&&(jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").slideUp(),jQuery(".mwb_"+e+"_gf__feeds-wrap").nextAll(".mwb-content-wrap").remove(),jQuery(".mwb-feed__select-object").closest("div.mwb_"+e+"_gf__feeds-wrap").parent().append(t.data.html),jQuery(".mwb-content-wrap").slideDown())}))})),jQuery(document).on("change",".field-type-select",(function(e){let t=jQuery(this),n=t.val(),i=t.closest(".mwb-fields-form-row");i.find(".row-field-value").addClass("row-hide"),i.find(".row-"+n).removeClass("row-hide")})),jQuery(document).on("change",".custom-value-select",(function(e){let t=jQuery(this),n=t.val(),i=t.closest(".mwb-fields-form-row"),o=i.find(".custom-value-input").val();i.find(".custom-value-input").val(o+"{"+n+"}")})),jQuery(document).on("click","#add-new-field-btn",(function(t){t.preventDefault();let o=jQuery("#add-new-field-select"),a=o.val(),r=o.find("option:selected").text(),s=jQuery("#mwb-feeds-"+e+"-object").val(),l=jQuery("#mwb-"+e+"-gf-select-form").val();if("-1"==s)return void p("Select a valid Mautic object and its corresponding field");if("-1"==a)return void p("Select a Field to add");h({action:i,nonce:n,event:"add_new_field",object:s,form:l,field:a}).then((e=>{1==e.status?e.hasOwnProperty("data")&&(1==e.data.success?(j(o,a,!0),jQuery("#mwb-fields-form-section").append(e.data.html),w(a,r,"add")):y(e.data.msg)):y()}))})),jQuery(document).on("click",".mwb-fields-form-row .field-delete",(function(e){let t=jQuery(this).closest(".mwb-fields-form-row"),n=t.find(".crm-field-name").val(),i=jQuery("#add-new-field-select");t.slideUp("400",(function(){j(i,n,!1),w(n,"","remove"),t.remove()}))})),jQuery(document).on("click",".condition-or-btn",(function(t){if(t.preventDefault(),"-1"==jQuery("#mwb-"+e+"-gf-select-form").val())return void p("Please select a valid GF form");let n=jQuery(this).attr("data-next-or-index"),i=v(n);jQuery(this).before(i),n++,jQuery(this).attr("data-next-or-index",n)})),jQuery(document).on("click","img.dashicons-trash",(function(e){let t=jQuery(this).parents(".or-condition-filter");t.slideUp("400",(function(){t.remove()}))})),jQuery(document).on("click",".condition-and-btn",(function(t){if(t.preventDefault(),"-1"==jQuery("#mwb-"+e+"-gf-select-form").val())return void p("Please select a valid GF form");let n=jQuery(this).attr("data-or-index"),i=jQuery(this).attr("data-next-and-index"),o=((e=1,t=1)=>{let n="";return n+='<div class="and-condition-filter" data-and-index="'+e+'" data-or-index="'+t+'">',n+='<select name="condition['+t+"]["+e+'][field]" class="condition-form-field">',n+='<option value="-1">Select Field</option>',jQuery.each(_,(function(e,t){n+='<optgroup label="'+e+'">',jQuery.each(t,(function(e,t){n+='<option value="'+e+'" >'+t+"</option>"})),n+="</optgroup>"})),n+="</select>",n+='<select name="condition['+t+"]["+e+'][option]" class="condition-option-field">',n+='<option value="-1">Select Condition</option>',jQuery.each(f,(function(e,t){n+="<option value="+e+">"+t+"</option>"})),n+="</select>",n+='<input type="text" name="condition['+t+"]["+e+'][value]" class="condition-value-field" value="" placeholder="Enter value">',1!=e&&(n+='<span class="dashicons dashicons-no"></span>'),n+="</div>",n})(i,n);jQuery(this).before(o),i++,jQuery(this).attr("data-next-and-index",i)})),jQuery(document).on("click",".dashicons-no",(function(e){let t=jQuery(this).parents(".and-condition-filter");t.slideUp("400",(function(){t.remove()}))})),jQuery(document).on("change",".condition-option-field",(function(){let e=jQuery(this).val(),t=jQuery(this).next(".condition-value-field");"empty"==e||"not_empty"==e||"only_number"==e||"only_text"==e?t.val("").attr("disabled","disabled").removeAttr("placeholder"):t.val("").removeAttr("disabled").attr("placeholder","Enter value")})),jQuery(document).on("change","#add-note-select",(function(e){let t=jQuery(this).val(),n=jQuery("#add-feed-note").val();jQuery("#add-feed-note").val(n+"{"+t+"}")})),jQuery(".mwb-feed-status").on("change",(function(){let e="toggle_feed_status",t=jQuery(this).attr("feed-id");if(this.checked){h({action:i,nonce:n,event:e,feed_id:t,status:"publish"}).then((e=>{1==e.status&&jQuery(".mwb-feed-status-text_"+t).text("Active")}))}else{h({action:i,nonce:n,event:e,feed_id:t,status:"draft"}).then((e=>{1==e.status&&jQuery(".mwb-feed-status-text_"+t).text("Sandbox")}))}})),jQuery(".mwb_"+e+"_gf__trash_feed").on("click",(function(){let e=jQuery(this).parent().closest("li"),t=jQuery(this).attr("feed-id");h({action:i,nonce:n,event:"trash_feeds_from_list",feed_id:t}).then((t=>{1==t.status?e.slideUp("400",(function(){e.remove()})):y(o)}))})),jQuery(document).on("change",".filter-feeds-by-form",(function(){let t=jQuery(this).val();if("-1"==t)return void p("Select a valid GF form!!");h({action:i,nonce:n,form_id:t,event:"filter_feeds_by_form"}).then((t=>{1==t.status?1==t.data.status&&(jQuery(".mwb-"+e+"-gf__feed-list").slideUp(),jQuery(".mwb-"+e+"-gf__feed-list").html(t.data.feeds),jQuery(".mwb-"+e+"-gf__feed-list").slideDown()):y(t.msg)}))})),jQuery(".mwb_"+e+"_gf__feeds-wrap .mwb-feeds__meta-box-main-wrapper").slideDown(),jQuery(".mwb_"+e+"_gf__feeds-wrap .mwb-feeds__header-link").addClass("link-active"),jQuery(document).on("click","a.mwb-feeds__header-link",(function(){jQuery(this).toggleClass("link-active"),jQuery(this).siblings(".mwb-feeds__meta-box-main-wrapper").slideToggle(500)})),jQuery("#mwb-"+e+"-gf-clear-log").on("click",(function(e){e.preventDefault();var t=jQuery(this);t.text("Loading..."),h({action:i,nonce:n,event:"clear_sync_log"}).then((e=>{1==e.status?1==e.data.success&&(t.text("Clear Log"),window.location.reload()):y(o)}))})),jQuery("#mwb-"+e+"-gf-download-log").on("click",(function(e){e.preventDefault();var t=jQuery(this);t.text("Loading..."),h({action:i,nonce:n,event:"download_sync_log"}).then((e=>{1==e.status?(t.text("Download"),1==e.data.success?location.href=e.data.redirect:0==e.data.success&&y(e.data.msg)):y(o)}))}))}));